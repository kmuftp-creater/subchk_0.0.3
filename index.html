<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>字幕喬一下 - 通用格式轉換與時間軸順序排列</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (用於在瀏覽器中解析 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f5f9; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #cbd5e1; 
          border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #94a3b8; 
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons Components (內嵌 SVG 以確保無需外部依賴) ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const FileText = (p) => <IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconBase>;
        const Upload = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></IconBase>;
        const Trash2 = (p) => <IconBase {...p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>;
        const RefreshCw = (p) => <IconBase {...p}><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const AlertCircle = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>;
        const Eye = (p) => <IconBase {...p}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const X = (p) => <IconBase {...p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const Activity = (p) => <IconBase {...p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>;
        const Clock = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;

        // --- 核心邏輯層 (Core Logic Layer) ---

        const SUPPORTED_FORMATS = ['srt', 'vtt', 'ass', 'ssa', 'sub', 'txt'];
        const TARGET_FORMATS = ['srt', 'vtt', 'ass', 'ssa', 'sub'];
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const getCurrentTime = () => new Date().toLocaleTimeString('zh-TW', { hour12: false });

        const parseSRT = (content) => {
            const normalized = content.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const blocks = normalized.split('\n\n');
            const cues = [];
            blocks.forEach((block) => {
                const lines = block.split('\n').filter(line => line.trim() !== '');
                if (lines.length >= 2) {
                    let timeLineIndex = lines.findIndex(l => l.includes('-->'));
                    if (timeLineIndex !== -1) {
                        const timeLine = lines[timeLineIndex];
                        const [start, end] = timeLine.split(' --> ').map(t => t.trim());
                        const text = lines.slice(timeLineIndex + 1).join('\n');
                        cues.push({ start, end, text });
                    }
                }
            });
            return cues;
        };

        const parseVTT = (content) => {
            const normalized = content.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const lines = normalized.split('\n');
            const cues = [];
            let currentCue = { start: '', end: '', text: [] };
            let isHeader = true;
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (isHeader && line.startsWith('WEBVTT')) { isHeader = false; continue; }
                if (line === '') {
                    if (currentCue.start) {
                        cues.push({ ...currentCue, text: currentCue.text.join('\n') });
                        currentCue = { start: '', end: '', text: [] };
                    }
                    continue;
                }
                if (line.includes('-->')) {
                    const [start, end] = line.split('-->').map(t => t.trim());
                    currentCue.start = start;
                    currentCue.end = end;
                } else if (currentCue.start) {
                    currentCue.text.push(line);
                }
            }
            if (currentCue.start) cues.push({ ...currentCue, text: currentCue.text.join('\n') });
            return cues;
        };

        const formatTimestamp = (timeStr, format) => {
            if (!timeStr) return '00:00:00,000';
            let base = timeStr.replace(',', '.');
            const parts = base.split(':');
            if (parts.length === 2) base = `00:${base}`;
            if (format === 'srt') return base.replace('.', ',');
            if (format === 'vtt') return base;
            return base;
        };

        const formatTimestampASS = (timeStr) => {
            const base = formatTimestamp(timeStr, 'vtt'); 
            const [time, ms] = base.split('.');
            const [h, m, s] = time.split(':');
            const hour = parseInt(h, 10); 
            const centisec = ms ? ms.substring(0, 2) : '00';
            return `${hour}:${m}:${s}.${centisec}`;
        };

        const buildSRT = (cues) => {
            let output = '';
            cues.forEach((cue, index) => {
                output += `${index + 1}\n`;
                output += `${formatTimestamp(cue.start, 'srt')} --> ${formatTimestamp(cue.end, 'srt')}\n`;
                output += `${cue.text}\n\n`;
            });
            return output;
        };

        const buildVTT = (cues) => {
            let output = 'WEBVTT\n\n';
            cues.forEach((cue, index) => {
                output += `${index + 1}\n`;
                output += `${formatTimestamp(cue.start, 'vtt')} --> ${formatTimestamp(cue.end, 'vtt')}\n`;
                output += `${cue.text}\n\n`;
            });
            return output;
        };

        const buildASS = (cues, isSSA = false) => {
            const header = `[Script Info]\nTitle: Converted by SubtitleMaster\nScriptType: v4.00+\nWrapStyle: 0\nScaledBorderAndShadow: yes\nYCbCr Matrix: None\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: Default,Arial,20,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,2,2,10,10,10,1\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text\n`;
            let output = isSSA ? header.replace('v4.00+', 'v4.00') : header;
            cues.forEach(cue => {
                const text = cue.text.replace(/\n/g, '\\N');
                const start = formatTimestampASS(cue.start);
                const end = formatTimestampASS(cue.end);
                output += `Dialogue: 0,${start},${end},Default,,0,0,0,,${text}\n`;
            });
            return output;
        };

        const buildSUB = (cues) => {
            let output = `[INFORMATION]\n[TITLE]Converted Subtitle\n[AUTHOR]SubtitleMaster\n[SOURCE]\n[PRG]\n[FILEPATH]\n[DELAY]0\n[CD TRACK]0\n[COMMENT]\n[END INFORMATION]\n[SUBTITLE]\n[COLF]&HFFFFFF,[STYLE]no,[SIZE]18,[FONT]Arial\n`;
            cues.forEach(cue => {
                const start = formatTimestampASS(cue.start); 
                const end = formatTimestampASS(cue.end);
                const text = cue.text.replace(/\n/g, '[br]');
                output += `${start},${end}\n${text}\n\n`;
            });
            return output;
        };

        const convertSubtitle = (content, sourceExt, targetExt) => {
            let cues = [];
            try {
                if (sourceExt === 'srt' || sourceExt === 'txt') {
                    cues = parseSRT(content);
                } else if (sourceExt === 'vtt') {
                    cues = parseVTT(content);
                } else {
                    try {
                        if (content.includes('-->')) cues = parseSRT(content);
                        else throw new Error('Complex format parsing not fully supported yet');
                    } catch {
                        cues = parseSRT(content);
                    }
                }
            } catch (e) {
                throw new Error(`來源格式解析錯誤: ${sourceExt.toUpperCase()}`);
            }
            if (cues.length === 0) throw new Error('解析失敗：找不到有效的字幕塊');

            switch (targetExt) {
                case 'srt': return buildSRT(cues);
                case 'vtt': return buildVTT(cues);
                case 'ass': return buildASS(cues, false);
                case 'ssa': return buildASS(cues, true);
                case 'sub': return buildSUB(cues);
                default: return buildSRT(cues);
            }
        };

        // --- 主應用組件 ---

        function App() {
            const [files, setFiles] = useState([]);
            const [isDragging, setIsDragging] = useState(false);
            const [logs, setLogs] = useState([]);
            const [previewFile, setPreviewFile] = useState(null);

            const addLog = (message, type = 'info') => {
                const timestamp = getCurrentTime();
                setLogs(prev => [{ id: generateId(), timestamp, message, type }, ...prev]);
            };

            const handleFiles = (newFiles) => {
                const validFiles = Array.from(newFiles).map(file => {
                    const ext = file.name.split('.').pop().toLowerCase();
                    if (!SUPPORTED_FORMATS.includes(ext)) {
                        addLog(`檔案 ${file.name} 格式不支援`, 'error');
                        return null;
                    }
                    return {
                        id: generateId(),
                        fileObj: file,
                        name: file.name,
                        size: (file.size / 1024).toFixed(2) + ' KB',
                        sourceExt: ext,
                        targetExt: 'srt',
                        status: 'waiting',
                        resultContent: null,
                        errorMessage: null
                    };
                }).filter(f => f !== null);

                if (validFiles.length > 0) {
                    setFiles(prev => [...validFiles, ...prev]);
                    addLog(`已新增 ${validFiles.length} 個檔案等待處理`);
                }
            };

            const onDragOver = (e) => { e.preventDefault(); setIsDragging(true); };
            const onDragLeave = (e) => { e.preventDefault(); setIsDragging(false); };
            const onDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                handleFiles(e.dataTransfer.files);
            };
            const onFileInput = (e) => { handleFiles(e.target.files); };

            const updateTargetFormat = (id, newFormat) => {
                setFiles(files.map(f => f.id === id ? { ...f, targetExt: newFormat, status: 'waiting' } : f));
            };

            const removeFile = (id) => {
                setFiles(files.filter(f => f.id !== id));
            };

            const processFile = async (fileItem) => {
                setFiles(prev => prev.map(f => f.id === fileItem.id ? { ...f, status: 'processing' } : f));
                await new Promise(resolve => setTimeout(resolve, 600)); 

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const content = e.target.result;
                        const converted = convertSubtitle(content, fileItem.sourceExt, fileItem.targetExt);
                        setFiles(prev => prev.map(f => {
                            if (f.id === fileItem.id) return { ...f, status: 'success', resultContent: converted };
                            return f;
                        }));
                        addLog(`檔案 ${fileItem.name} 轉換成功`, 'success');
                    } catch (error) {
                        setFiles(prev => prev.map(f => {
                            if (f.id === fileItem.id) return { ...f, status: 'error', errorMessage: error.message };
                            return f;
                        }));
                        addLog(`檔案 ${fileItem.name} 轉換失敗: ${error.message}`, 'error');
                    }
                };
                reader.readAsText(fileItem.fileObj);
            };

            const processAll = () => {
                const waitingFiles = files.filter(f => f.status === 'waiting' || f.status === 'error');
                if (waitingFiles.length === 0) {
                    addLog('沒有需要處理的檔案', 'warning');
                    return;
                }
                addLog(`開始批量處理 ${waitingFiles.length} 個檔案...`);
                waitingFiles.forEach(f => processFile(f));
            };

            const downloadFile = (fileItem) => {
                if (!fileItem.resultContent) return;
                const blob = new Blob([fileItem.resultContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const newName = fileItem.name.replace(`.${fileItem.sourceExt}`, `_converted.${fileItem.targetExt}`);
                a.href = url;
                a.download = newName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                addLog(`已下載: ${newName}`);
            };

            const downloadAll = () => {
                const successFiles = files.filter(f => f.status === 'success');
                if (successFiles.length === 0) return;
                addLog(`開始下載 ${successFiles.length} 個檔案`);
                successFiles.forEach((f, index) => {
                    setTimeout(() => downloadFile(f), index * 300);
                });
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans flex flex-col">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white">
                                    <FileText size={20} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-slate-900 tracking-tight">字幕喬一下</h1>
                                    <p className="text-xs text-slate-500">通用格式轉換與時間軸順序排列</p>
                                </div>
                            </div>
                            <div className="text-xs text-slate-400">Version: v0.0.3</div>
                        </div>
                    </header>

                    <main className="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full grid grid-cols-1 lg:grid-cols-3 gap-8">
                        {/* Left / Top: Main Operation Area */}
                        <div className="lg:col-span-2 space-y-6">
                            {/* Upload Zone */}
                            <div 
                                className={`relative rounded-2xl border-2 border-dashed transition-all duration-200 ease-in-out p-10 text-center cursor-pointer ${isDragging ? 'border-indigo-500 bg-indigo-50 scale-[1.01]' : 'border-slate-300 bg-white hover:border-indigo-300 hover:bg-slate-50'}`}
                                onDragOver={onDragOver} onDragLeave={onDragLeave} onDrop={onDrop}
                                onClick={() => document.getElementById('fileInput').click()}
                            >
                                <input type="file" id="fileInput" multiple className="hidden" accept=".srt,.vtt,.ass,.ssa,.sub,.txt" onChange={onFileInput} />
                                <div className="mx-auto w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mb-4">
                                    <Upload size={32} />
                                </div>
                                <h3 className="text-lg font-semibold text-slate-700">拖曳檔案至此 或 點擊上傳</h3>
                                <p className="mt-2 text-sm text-slate-500">支援 .SRT, .VTT, .ASS, .SSA, .SUB (多檔案批次上傳)</p>
                            </div>

                            {/* Controls */}
                            <div className="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                                <div className="flex items-center space-x-2">
                                    <span className="text-sm font-medium text-slate-600">已選擇: {files.length} 個檔案</span>
                                </div>
                                <div className="flex space-x-3">
                                    <button 
                                        onClick={() => setFiles([])}
                                        className={`px-4 py-2 text-sm font-bold border-2 rounded-lg transition-all flex items-center ${files.length === 0 ? 'border-slate-200 text-slate-300 cursor-not-allowed' : 'border-red-100 text-red-500 hover:bg-red-50 hover:border-red-200 hover:text-red-600 shadow-sm'}`}
                                        disabled={files.length === 0}
                                    >
                                        <Trash2 size={16} className="mr-2" /> 清空列表
                                    </button>
                                    <button 
                                        onClick={processAll}
                                        disabled={files.length === 0}
                                        className={`px-6 py-2 rounded-lg text-sm font-bold text-white shadow-md flex items-center transition-all ${files.length === 0 ? 'bg-slate-300 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700 hover:shadow-lg active:transform active:scale-95'}`}
                                    >
                                        <RefreshCw size={16} className="mr-2" /> 開始批量處理
                                    </button>
                                </div>
                            </div>

                            {/* File List */}
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden min-h-[300px]">
                                {files.length === 0 ? (
                                    <div className="flex flex-col items-center justify-center h-64 text-slate-400">
                                        <Activity size={48} className="mb-4 opacity-20" />
                                        <p>尚無檔案，請先上傳</p>
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left text-sm">
                                            <thead className="bg-slate-50 text-slate-500 border-b border-slate-200">
                                                <tr>
                                                    <th className="px-6 py-3 font-medium">檔案名稱</th>
                                                    <th className="px-6 py-3 font-medium">原始格式</th>
                                                    <th className="px-6 py-3 font-medium">目標格式</th>
                                                    <th className="px-6 py-3 font-medium">狀態</th>
                                                    <th className="px-6 py-3 font-medium text-right">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {files.map((file) => (
                                                    <tr key={file.id} className="hover:bg-slate-50 transition-colors group">
                                                        <td className="px-6 py-4 font-medium text-slate-700 max-w-xs truncate" title={file.name}>
                                                            {file.name}
                                                            <div className="text-xs text-slate-400 font-normal">{file.size}</div>
                                                        </td>
                                                        <td className="px-6 py-4 uppercase text-slate-500">{file.sourceExt}</td>
                                                        <td className="px-6 py-4">
                                                            <select 
                                                                value={file.targetExt}
                                                                onChange={(e) => updateTargetFormat(file.id, e.target.value)}
                                                                className="bg-white border border-slate-300 text-slate-700 text-xs rounded-md px-2 py-1 outline-none focus:border-indigo-500"
                                                                disabled={file.status === 'processing' || file.status === 'success'}
                                                            >
                                                                {TARGET_FORMATS.map(fmt => (
                                                                    <option key={fmt} value={fmt}>{fmt.toUpperCase()}</option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            {file.status === 'waiting' && <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">等待中</span>}
                                                            {file.status === 'processing' && <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"><RefreshCw size={12} className="mr-1 animate-spin"/> 處理中</span>}
                                                            {file.status === 'success' && <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><CheckCircle size={12} className="mr-1"/> 完成</span>}
                                                            {file.status === 'error' && (
                                                                <div className="flex flex-col">
                                                                    <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 w-fit"><AlertCircle size={12} className="mr-1"/> 錯誤</span>
                                                                    <span className="text-[10px] text-red-500 mt-1 max-w-[150px] truncate" title={file.errorMessage}>{file.errorMessage}</span>
                                                                </div>
                                                            )}
                                                        </td>
                                                        <td className="px-6 py-4 text-right">
                                                            <div className="flex items-center justify-end space-x-2">
                                                                {file.status === 'success' && (
                                                                    <>
                                                                        <button onClick={() => setPreviewFile(file)} className="p-1.5 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors" title="預覽"><Eye size={16} /></button>
                                                                        <button onClick={() => downloadFile(file)} className="p-1.5 text-slate-500 hover:text-green-600 hover:bg-green-50 rounded-md transition-colors" title="下載"><Download size={16} /></button>
                                                                    </>
                                                                )}
                                                                <button onClick={() => removeFile(file.id)} className="p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-md transition-colors opacity-0 group-hover:opacity-100" title="移除"><X size={16} /></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>

                            {/* Bulk Actions Footer */}
                            {files.some(f => f.status === 'success') && (
                                <div className="flex justify-end pt-4">
                                    <button onClick={downloadAll} className="flex items-center px-6 py-3 bg-slate-800 text-white text-sm font-medium rounded-lg shadow-md hover:bg-slate-900 transition-colors">
                                        <Download size={18} className="mr-2" />
                                        下載全部完成檔案
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Right: Logs & Info */}
                        <div className="lg:col-span-1 space-y-6">
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col h-[calc(100vh-200px)] min-h-[500px] sticky top-24">
                                <div className="px-5 py-4 border-b border-slate-100 bg-slate-50 rounded-t-xl flex justify-between items-center">
                                    <h3 className="font-semibold text-slate-700 flex items-center"><Clock size={16} className="mr-2 text-slate-400" />操作歷史紀錄</h3>
                                    <span className="text-xs text-slate-400 bg-white px-2 py-1 rounded border border-slate-200">{logs.length} 條紀錄</span>
                                </div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
                                    {logs.length === 0 ? <div className="text-center text-slate-400 text-sm mt-10">尚無操作紀錄</div> : logs.map((log) => (
                                        <div key={log.id} className="flex items-start space-x-3 text-sm animate-fade-in">
                                            <span className="text-xs font-mono text-slate-400 mt-0.5 min-w-[50px]">{log.timestamp}</span>
                                            <div className={`flex-1 ${log.type === 'error' ? 'text-red-600' : log.type === 'success' ? 'text-green-600' : log.type === 'warning' ? 'text-amber-600' : 'text-slate-600'}`}>{log.message}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="bg-white border-t border-slate-200 mt-auto py-6">
                        <div className="max-w-7xl mx-auto px-4 text-center">
                            <p className="text-slate-500 text-sm">© {new Date().getFullYear()} <a href="https://huobest.com/" target="_blank" rel="noopener noreferrer" className="text-indigo-600 hover:underline">霍家私塾</a>. All rights reserved.</p>
                        </div>
                    </footer>

                    {/* Preview Modal */}
                    {previewFile && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-md p-4 animate-fade-in">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-5xl h-[85vh] flex flex-col transform transition-all">
                                <div className="flex justify-between items-center p-5 border-b border-slate-100">
                                    <div>
                                        <h3 className="text-xl font-bold text-slate-800 flex items-center"><Eye size={20} className="mr-2 text-indigo-500" />內容預覽</h3>
                                        <p className="text-sm text-slate-500 mt-1 flex items-center">{previewFile.name} <span className="mx-2 text-slate-300">|</span> <span className="bg-indigo-50 text-indigo-700 px-2 py-0.5 rounded text-xs font-mono uppercase">{previewFile.targetExt}</span></p>
                                    </div>
                                    <button onClick={() => setPreviewFile(null)} className="p-2 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-600"><X size={24} /></button>
                                </div>
                                <div className="p-0 flex-1 overflow-hidden relative bg-slate-50">
                                    <textarea className="w-full h-full p-6 font-mono text-sm leading-relaxed text-slate-700 bg-slate-50 focus:outline-none resize-none" value={previewFile.resultContent} readOnly spellCheck="false" />
                                </div>
                                <div className="p-4 border-t border-slate-100 flex justify-end space-x-3 bg-white rounded-b-2xl">
                                    <button onClick={() => setPreviewFile(null)} className="px-5 py-2.5 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium transition-colors">關閉預覽</button>
                                    <button onClick={() => downloadFile(previewFile)} className="px-5 py-2.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 shadow-md hover:shadow-lg transition-all flex items-center"><Download size={18} className="mr-2" />下載此檔案</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>